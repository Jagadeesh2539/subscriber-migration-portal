AWSTemplateFormatVersion: "2010-09-09"
Description: Subscriber Migration Portal Infrastructure (Minimal Working)

Resources:

  # Frontend S3 bucket (unique name)
  FrontendBucket:
    Type: AWS::S3::Bucket
    Properties:
      BucketName: !Sub "${AWS::AccountId}-subscriber-frontend-bucket"
      AccessControl: PublicRead
      WebsiteConfiguration:
        IndexDocument: index.html

  # DynamoDB table for subscribers
  SubscriberTable:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: SubscriberTable
      AttributeDefinitions:
        - AttributeName: subscriberId
          AttributeType: S
      KeySchema:
        - AttributeName: subscriberId
          KeyType: HASH
      BillingMode: PAY_PER_REQUEST

  # DynamoDB table for audit logs
  AuditLogTable:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: AuditLogTable
      AttributeDefinitions:
        - AttributeName: id
          AttributeType: S
        - AttributeName: timestamp
          AttributeType: S
      KeySchema:
        - AttributeName: id
          KeyType: HASH
        - AttributeName: timestamp
          KeyType: RANGE
      BillingMode: PAY_PER_REQUEST

Outputs:
  FrontendURL:
    Description: URL for frontend S3 bucket
    Value: !Sub "http://${FrontendBucket}.s3-website.${AWS::Region}.amazonaws.com"

  SubscriberTableName:
    Description: DynamoDB table name
    Value: !Ref SubscriberTable

  AuditLogTableName:
    Description: DynamoDB table name
    Value: !Ref AuditLogTable
