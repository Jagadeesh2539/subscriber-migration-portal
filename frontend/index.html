<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>üöÄ Enterprise Migration Portal</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="icon" type="image/x-icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAA==">
  <style>/* styles omitted for brevity - unchanged from previous commit */</style>
</head>
<body>
  <!-- ... markup unchanged ... -->
  <script>
    // APP CONFIG - HYBRID MODE (Dummy login, real APIs)
    const APP_CONFIG = {
      DEMO_LOGIN: true, // dummy login only
      API_BASE: 'https://u5f4sinkv3.execute-api.us-east-1.amazonaws.com/prod',
      VERSION: '3.4.0',
      REFRESH_INTERVAL: 30000
    };

    // AUTH - Dummy login only; rest of app uses real API
    const auth = {
      currentUser: null,
      checkAuth() {
        const token = sessionStorage.getItem('authToken');
        const username = sessionStorage.getItem('username');
        if (token && username) {
          this.currentUser = { username, token };
          document.getElementById('login-screen').style.display = 'none';
          document.getElementById('app-shell').style.display = 'block';
          document.getElementById('username-display').textContent = username;
          document.getElementById('user-avatar').textContent = username.charAt(0).toUpperCase();
          setTimeout(() => { api.checkHealth(); dashboard.load(); }, 300);
        } else {
          document.getElementById('login-screen').style.display = 'flex';
          document.getElementById('app-shell').style.display = 'none';
        }
      },
      async login() {
        const username = document.getElementById('username').value.trim();
        const password = document.getElementById('password').value.trim();
        const btn = document.getElementById('login-btn');
        const err = document.getElementById('login-error');
        if (!username || !password) { this.showLoginError('Please enter both username and password'); return; }

        btn.disabled = true; btn.innerHTML = '<div class="loading-spinner" style="width:20px;height:20px;border-width:2px"></div> <span>Signing in...</span>'; err.style.display = 'none';

        try {
          if (APP_CONFIG.DEMO_LOGIN) {
            // accept any creds; set a dummy bearer token so downstream Authorization header is present
            sessionStorage.setItem('authToken', `demo-token-${Date.now()}`);
            sessionStorage.setItem('username', username);
            utils.showNotification('üé≠ Signed in (Dummy login enabled)', 'success');
            this.checkAuth();
            return;
          }
          // Real login path (kept for future switch)
          const res = await fetch(`${APP_CONFIG.API_BASE}/auth/login`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ username, password }) });
          if (!res.ok) throw new Error(await res.text());
          const data = await res.json();
          if (!data.token) throw new Error('Token missing');
          sessionStorage.setItem('authToken', data.token);
          sessionStorage.setItem('username', username);
          this.checkAuth();
        } catch (e) {
          this.showLoginError(e.message || 'Authentication failed');
        } finally {
          btn.disabled = false; btn.innerHTML = '<span>üîë Sign In to Portal</span>';
        }
      },
      showLoginError(m) { const el = document.getElementById('login-error'); el.textContent = m; el.style.display = 'block'; },
      logout() { ui.showConfirmationModal('Sign Out','Are you sure you want to sign out?',()=>{ sessionStorage.clear(); this.currentUser=null; this.checkAuth(); utils.showNotification('üëã Signed out', 'info');}); }
    };

    // API helper - always use full API Gateway URL and include Authorization header if present
    const api = {
      async request(endpoint, options = {}) {
        const token = sessionStorage.getItem('authToken');
        const cfg = { method: options.method || 'GET', headers: { ...(options.headers || {}) }, body: options.body };        
        const isFormData = (cfg.body && typeof FormData !== 'undefined' && cfg.body instanceof FormData);
        if (!isFormData) {
          cfg.headers['Accept'] = 'application/json';
          if (cfg.body && typeof cfg.body === 'object') { cfg.headers['Content-Type'] = 'application/json'; cfg.body = JSON.stringify(cfg.body); }
          else if (!cfg.headers['Content-Type']) { cfg.headers['Content-Type'] = 'application/json'; }
        }
        if (token) cfg.headers['Authorization'] = `Bearer ${token}`;
        const res = await fetch(`${APP_CONFIG.API_BASE}${endpoint}`, cfg);
        if (res.status === 401) { utils.showNotification('üîí Unauthorized - session reset', 'error'); sessionStorage.clear(); auth.checkAuth(); }
        return res;
      },
      async checkHealth() {
        const el = document.getElementById('api-status'); el.className='alert info'; el.textContent='üîÑ Testing backend connection...';
        try {
          const r = await fetch(`${APP_CONFIG.API_BASE}/health`);
          if (!r.ok) throw new Error(`HTTP ${r.status}`);
          const d = await r.json();
          el.className='alert success'; el.innerHTML = `‚úÖ <strong>Backend Connected!</strong><br>API Version: ${d.version||'-'} | Status: ${d.status||'-'}`;
          document.getElementById('api-health').textContent = 'üü¢ Connected';
          document.getElementById('lambda-health').textContent = 'üü¢ Operational';
          document.getElementById('db-health').textContent = d.environment?.rds_configured ? 'üü¢ Connected' : 'üü° DynamoDB';
          return true;
        } catch(e) {
          el.className='alert error'; el.innerHTML = `‚ùå <strong>Backend Offline</strong><br>Error: ${e.message}`;
          document.getElementById('api-health').textContent = 'üî¥ Failed';
          document.getElementById('lambda-health').textContent = 'üü° Unknown';
          document.getElementById('db-health').textContent = 'üü° Unknown';
          return false;
        }
      }
    };

    // UI routing unchanged from previous working version
    // Dashboard, migration, provisioning, query, monitoring, settings modules
    // still call api.request('/subscribers'), '/jobs', '/migration/upload', '/query', etc.
    // ... keep the rest of the previous working script body intact ...
  </script>
</body>
</html>
